### Poker Club API — заполнение базы с нуля и проверка функционала
### Выполняйте запросы по порядку. После запросов с созданием сущностей подставляйте id из ответа в переменные ниже.

@baseUrl = http://localhost:3000

# Подставьте сюда токен после шага 2 (Login). Один пользователь = админ и игрок.
@token = 

# Подставьте id после шага 4 (создание наград) — из ответов POST /rewards (reward1, reward2, reward3)
@reward1Id = 
@reward2Id = 
@reward3Id = 

# Подставьте после шага 5 (создание структуры блайндов)
@blindStructureId = 

# Подставьте после шага 6 (создание клуба)
@clubId = 

# Подставьте после шага 6 — из GET /clubs/{{clubId}}/tables (любой id стола)
@clubTableId = 

# Подставьте после шага 6 — из GET /clubs/{{clubId}}/schedules (id любого расписания)
@scheduleId = 

# Подставьте после шага 7 (создание турнира)
@tournamentId = 

# Подставьте после шага 8 (регистрация) — из GET /tournaments/{{tournamentId}}/players (playerId первого игрока)
@playerId = 

# Подставьте после шага 10 (рассадка) — из GET /tournaments/{{tournamentId}}/tables (id любого стола с игроками)
@tournamentTableId = 

# Опционально: для заказов — id категории и позиции меню (шаги 15–16)
@categoryId = 
@menuItemId = 

################################################################################
# ШАГ 0. Проверка сервера
################################################################################

### 0.1 Health
GET {{baseUrl}}/health

################################################################################
# ШАГ 1–2. Аутентификация (с нуля: регистрация + вход)
################################################################################

### 1.1 Регистрация администратора (один раз для пустой БД)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "firstName": "Админ",
  "lastName": "Клуба",
  "phone": "+79001234567",
  "email": "admin@club.local",
  "password": "admin123"
}

### 2.1 Вход — скопируйте accessToken из ответа в переменную @token в начале файла
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "phone": "+79001234567",
  "password": "admin123"
}

### 2.2 Текущий пользователь
GET {{baseUrl}}/auth/me
Authorization: Bearer {{token}}

################################################################################
# ШАГ 3. Награды (каталог для турниров)
################################################################################

### 3.1 Награда — 1 место (кубок)
POST {{baseUrl}}/rewards
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Кубок чемпиона",
  "description": "Кубок с фото для 1 места",
  "imageUrl": "https://example.com/trophy.png",
  "type": "TROPHY"
}

### 3.2 Награда — 2 место (карточка)
POST {{baseUrl}}/rewards
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Карточка бесплатного посещения",
  "description": "Одно бесплатное посещение клуба",
  "imageUrl": "https://example.com/card.png",
  "type": "CARD"
}

### 3.3 Награда — 3 место
POST {{baseUrl}}/rewards
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Сертификат на напиток",
  "description": "Бесплатный напиток в баре",
  "type": "CERTIFICATE"
}

### 3.4 Список наград (взять id для @reward1Id, @reward2Id, @reward3Id)
GET {{baseUrl}}/rewards
Authorization: Bearer {{token}}

################################################################################
# ШАГ 4. Структуры блайндов
################################################################################

### 4.1 Создать структуру
POST {{baseUrl}}/blind-structures
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Стандартная 15 мин",
  "description": "Базовая структура",
  "levelDurationMinutes": 15
}

### 4.2 Добавить уровни (подставьте blindStructureId из ответа 4.1)
POST {{baseUrl}}/blind-structures/{{blindStructureId}}/levels
Authorization: Bearer {{token}}
Content-Type: application/json

{"levelNumber": 1, "smallBlind": 25, "bigBlind": 50, "ante": 0}

###
POST {{baseUrl}}/blind-structures/{{blindStructureId}}/levels
Authorization: Bearer {{token}}
Content-Type: application/json

{"levelNumber": 2, "smallBlind": 50, "bigBlind": 100, "ante": 0}

###
POST {{baseUrl}}/blind-structures/{{blindStructureId}}/levels
Authorization: Bearer {{token}}
Content-Type: application/json

{"levelNumber": 3, "smallBlind": 100, "bigBlind": 200, "ante": 25}

### 4.3 Список структур (взять id для @blindStructureId)
GET {{baseUrl}}/blind-structures
Authorization: Bearer {{token}}

################################################################################
# ШАГ 5. Клуб (столы создаются автоматически)
################################################################################

### 5.1 Создать клуб — id из ответа в @clubId
POST {{baseUrl}}/clubs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Покер Клуб Москва",
  "description": "Главный покерный клуб",
  "address": "ул. Тверская, 1",
  "phone": "+7 (495) 123-45-67",
  "tableCount": 5
}

### 5.2 Список клубов
GET {{baseUrl}}/clubs
Authorization: Bearer {{token}}

### 5.3 Клуб по ID + столы и расписание
GET {{baseUrl}}/clubs/{{clubId}}
Authorization: Bearer {{token}}

### 5.4 Столы клуба (взять id любого стола в @clubTableId при необходимости)
GET {{baseUrl}}/clubs/{{clubId}}/tables
Authorization: Bearer {{token}}

### 5.5 Расписание — понедельник
POST {{baseUrl}}/clubs/{{clubId}}/schedules
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "dayOfWeek": 1,
  "startTime": "18:00:00",
  "endTime": "23:00:00",
  "eventType": "TOURNAMENT",
  "description": "Еженедельный турнир"
}

### 5.6 Расписание — пятница
POST {{baseUrl}}/clubs/{{clubId}}/schedules
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "dayOfWeek": 5,
  "startTime": "19:00:00",
  "endTime": "02:00:00",
  "eventType": "CASH_GAME",
  "description": "Кэш-игры"
}

### 5.7 Получить расписание (id в @scheduleId при необходимости)
GET {{baseUrl}}/clubs/{{clubId}}/schedules
Authorization: Bearer {{token}}

################################################################################
# ШАГ 6. Турнир (с наградами и клубом)
################################################################################

### 6.1 Создать турнир — id в @tournamentId. Укажите reward1Id, reward2Id, reward3Id и clubId, blindStructureId
POST {{baseUrl}}/tournaments
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Еженедельный турнир",
  "clubId": "{{clubId}}",
  "startTime": "2026-03-01T18:00:00.000Z",
  "buyInCost": 1000,
  "startingStack": 10000,
  "addonChips": 5000,
  "rebuyChips": 10000,
  "blindStructureId": "{{blindStructureId}}",
  "rewards": [
    { "rewardId": "{{reward1Id}}", "place": 1 },
    { "rewardId": "{{reward2Id}}", "place": 2 },
    { "rewardId": "{{reward3Id}}", "place": 3 }
  ]
}

### 6.2 Список турниров
GET {{baseUrl}}/tournaments
Authorization: Bearer {{token}}

### 6.3 Турнир по ID (с наградами и клубом)
GET {{baseUrl}}/tournaments/{{tournamentId}}
Authorization: Bearer {{token}}

################################################################################
# ШАГ 7. Регистрация на турнир + финансы
################################################################################

### 7.1 Пополнить депозит (для бай-ина)
POST {{baseUrl}}/user/deposit/topup
Authorization: Bearer {{token}}
Content-Type: application/json

{"amount": 10000}

### 7.2 Баланс
GET {{baseUrl}}/user/deposit
Authorization: Bearer {{token}}

### 7.3 Зарегистрироваться на турнир
POST {{baseUrl}}/tournaments/{{tournamentId}}/register
Authorization: Bearer {{token}}
Content-Type: application/json

{"paymentMethod": "DEPOSIT"}

### 7.4 Участники турнира — взять id игрока в @playerId
GET {{baseUrl}}/tournaments/{{tournamentId}}/players
Authorization: Bearer {{token}}

################################################################################
# ШАГ 8. Рассадка и запуск турнира
################################################################################

### 8.1 Инициализировать столы турнира из столов клуба
POST {{baseUrl}}/tournaments/{{tournamentId}}/tables/init-from-club
Authorization: Bearer {{token}}

### 8.2 Автоматическая рассадка
POST {{baseUrl}}/tournaments/{{tournamentId}}/seating/auto
Authorization: Bearer {{token}}

### 8.3 Столы турнира (id стола в @tournamentTableId при необходимости)
GET {{baseUrl}}/tournaments/{{tournamentId}}/tables
Authorization: Bearer {{token}}

### 8.4 Статус турнира → RUNNING
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/status
Authorization: Bearer {{token}}
Content-Type: application/json

{"status": "RUNNING"}

################################################################################
# ШАГ 9. Live State и метрики фишек
################################################################################

### 9.1 Live State (playersCount, totalParticipants, totalEntries, averageStack)
GET {{baseUrl}}/tournaments/{{tournamentId}}/live
Authorization: Bearer {{token}}

### 9.2 Пересчитать статистику
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/live/recalculate
Authorization: Bearer {{token}}

### 9.3 Текущий уровень
GET {{baseUrl}}/tournaments/{{tournamentId}}/level/current
Authorization: Bearer {{token}}

### 9.4 Следующий уровень (ADMIN)
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/level/next
Authorization: Bearer {{token}}

### 9.5 Пауза / возобновление
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/pause
Authorization: Bearer {{token}}

###
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/resume
Authorization: Bearer {{token}}

################################################################################
# ШАГ 10. Ребай, аддон, выбытие (проверка LiveTournament)
################################################################################

### 10.1 Ребай игрока
POST {{baseUrl}}/tournaments/{{tournamentId}}/player/{{playerId}}/rebuy
Authorization: Bearer {{token}}
Content-Type: application/json

{"amount": 1000}

### 10.2 Аддон игрока
POST {{baseUrl}}/tournaments/{{tournamentId}}/player/{{playerId}}/addon
Authorization: Bearer {{token}}
Content-Type: application/json

{"amount": 500}

### 10.3 Операции игрока по турниру
GET {{baseUrl}}/tournaments/{{tournamentId}}/player/{{playerId}}/operations
Authorization: Bearer {{token}}

### 10.4 Выбытие (finishPosition — место вылета)
POST {{baseUrl}}/tournaments/{{tournamentId}}/player/{{playerId}}/eliminate
Authorization: Bearer {{token}}
Content-Type: application/json

{"finishPosition": 5}

### 10.5 Завершить турнир (когда остался 1 или нужно закрыть)
POST {{baseUrl}}/tournaments/{{tournamentId}}/finish
Authorization: Bearer {{token}}

################################################################################
# ШАГ 11. Финансы и операции
################################################################################

### 11.1 История операций
GET {{baseUrl}}/user/operations
Authorization: Bearer {{token}}

################################################################################
# ШАГ 12. Меню и заказы
################################################################################

### 12.1 Категории меню
GET {{baseUrl}}/menu/categories
Authorization: Bearer {{token}}

### 12.2 Создать категорию — id в @categoryId
POST {{baseUrl}}/menu/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Напитки",
  "description": "Холодные и горячие напитки",
  "displayOrder": 1
}

### 12.3 Создать позицию меню — id в @menuItemId (укажите categoryId из 12.2)
POST {{baseUrl}}/menu/items
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Кофе эспрессо",
  "description": "Крепкий кофе",
  "price": 150,
  "categoryId": "{{categoryId}}",
  "isAvailable": true
}

### 12.4 Позиции меню
GET {{baseUrl}}/menu/items
Authorization: Bearer {{token}}

### 12.5 Создать заказ (укажите menuItemId и tournamentId)
POST {{baseUrl}}/orders
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "items": [{ "menuItemId": "{{menuItemId}}", "quantity": 2 }],
  "tournamentId": "{{tournamentId}}"
}

### 12.6 Мои заказы
GET {{baseUrl}}/orders/my
Authorization: Bearer {{token}}

################################################################################
# ШАГ 13. Статистика, рейтинги, ММР
################################################################################

### 13.1 Статистика пользователя (подставьте playerId)
GET {{baseUrl}}/statistics/user/{{playerId}}
Authorization: Bearer {{token}}

### 13.2 Рейтинги
GET {{baseUrl}}/leaderboards
Authorization: Bearer {{token}}

### 13.3 Топ по ММР
GET {{baseUrl}}/mmr/top
Authorization: Bearer {{token}}

### 13.4 Пересчитать ММР по турниру (после завершения)
POST {{baseUrl}}/mmr/recalculate/{{tournamentId}}
Authorization: Bearer {{token}}

### 13.5 Обновить рейтинг по ММР
POST {{baseUrl}}/leaderboards/rank-mmr/update
Authorization: Bearer {{token}}

################################################################################
# ШАГ 14. Достижения
################################################################################

### 14.1 Типы достижений
GET {{baseUrl}}/achievements/types
Authorization: Bearer {{token}}

### 14.2 Инициализировать типы (один раз)
POST {{baseUrl}}/achievements/seed
Authorization: Bearer {{token}}

### 14.3 Достижения пользователя
GET {{baseUrl}}/achievements/user/{{playerId}}
Authorization: Bearer {{token}}

### 14.4 Прогресс достижений
GET {{baseUrl}}/achievements/user/{{playerId}}/progress
Authorization: Bearer {{token}}

################################################################################
# ШАГ 15. Дополнительные проверки (клубы, награды, турниры)
################################################################################

### 15.1 Обновить награды турнира
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/rewards
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "rewards": [
    { "rewardId": "{{reward1Id}}", "place": 1 },
    { "rewardId": "{{reward2Id}}", "place": 2 },
    { "rewardId": "{{reward3Id}}", "place": 3 }
  ]
}

### 15.2 Обновить клуб
PATCH {{baseUrl}}/clubs/{{clubId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{"name": "Покер Клуб Москва (обновлено)", "isActive": true}

### 15.3 Статус стола клуба
PATCH {{baseUrl}}/clubs/{{clubId}}/tables/{{clubTableId}}/status
Authorization: Bearer {{token}}
Content-Type: application/json

{"status": "AVAILABLE"}

### 15.4 Обновить награду
PATCH {{baseUrl}}/rewards/{{reward1Id}}
Authorization: Bearer {{token}}
Content-Type: application/json

{"name": "Кубок чемпиона (золотой)", "description": "Обновлено"}

################################################################################
# Итоговая проверка
################################################################################

### Health
GET {{baseUrl}}/health

### Турниры клуба
GET {{baseUrl}}/tournaments?clubId={{clubId}}
Authorization: Bearer {{token}}

### Турнир с наградами и участниками
GET {{baseUrl}}/tournaments/{{tournamentId}}
Authorization: Bearer {{token}}
