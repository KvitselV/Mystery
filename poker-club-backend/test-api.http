### === ПЕРЕМЕННЫЕ ===
@baseUrl = http://localhost:3001
@adminToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjODAxYTliZi01MzBkLTQyMWEtYTVhOS1hZjk3ZGFmZmIyZTEiLCJyb2xlIjoiQURNSU4iLCJpYXQiOjE3NzAyNDI4OTIsImV4cCI6MTc3MDg0NzY5Mn0.ZSZgAXc8eQxRPZE8aeyCWsUY0wBjTP1nX-ufQ8NG6ZA
@tournamentId = bc3108ac-6bc8-4227-8648-d9f7aa5a4b44
@blindStructureId = 95656c73-9129-42d9-9d23-2e37d41ee0d6
@playerId = ab8a6498-8bce-42a5-98d4-4c84c5a5fc82


### ============================================
### ЭТАП 7.1: СТРУКТУРЫ БЛАЙНДОВ
### ============================================

### 3. Регистрация игрока 1
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "phone": "+79992222222",
  "email": "player1@test.com",
  "firstName": "Игрок",
  "lastName": "Первый",
  "password": "player123"
}

### 4. Регистрация игрока 2
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "phone": "+79993333333",
  "email": "player2@test.com",
  "firstName": "Игрок",
  "lastName": "Второй",
  "password": "player123"
}

### 7. Войти как игрок 1
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "phone": "+79992222222",
  "password": "player123"
}

# ⚠️ СКОПИРУЙ token игрока 1

### 8. Пополнить депозит игрока 1
POST {{baseUrl}}/user/deposit/topup
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjODAxYTliZi01MzBkLTQyMWEtYTVhOS1hZjk3ZGFmZmIyZTEiLCJyb2xlIjoiQURNSU4iLCJpYXQiOjE3NzAyNTM2OTcsImV4cCI6MTc3MDg1ODQ5N30.6cLz6dhMZXMjsNRgcMNIwkxMOht-wp6b0SRuTwJjyZ0

{
  "amount": 5000
}

### 9. Войти как игрок 2
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "phone": "+79993333333",
  "password": "player123"
}

# ⚠️ СКОПИРУЙ token игрока 2

### 10. Пополнить депозит игрока 2
POST {{baseUrl}}/user/deposit/topup
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI4NGU5NzQ2Yy01MjhjLTQzYjAtYTU1ZC0wNmU0MmRkZDYxNTciLCJyb2xlIjoiUExBWUVSIiwiaWF0IjoxNzcwMjQzMjc0LCJleHAiOjE3NzA4NDgwNzR9.NLtFoRgjf_rX4nrjPWlM7_YQrChtwiS7YTn6Fkee_GE

{
  "amount": 5000
}

### 1. Войти как администратор
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "phone": "+79991111111",
  "password": "admin123"
}

# ⚠️ СКОПИРУЙ token из ответа и замени @adminToken


### 2. Создать структуру блайндов "Стандартная"
POST {{baseUrl}}/blind-structures
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "name": "Стандартная структура",
  "description": "Стандартная структура для обычных турниров",
  "levels": [
    {
      "levelNumber": 1,
      "smallBlind": 25,
      "bigBlind": 50,
      "ante": 0,
      "durationMinutes": 20
    },
    {
      "levelNumber": 2,
      "smallBlind": 50,
      "bigBlind": 100,
      "ante": 0,
      "durationMinutes": 20
    },
    {
      "levelNumber": 3,
      "smallBlind": 75,
      "bigBlind": 150,
      "ante": 0,
      "durationMinutes": 20
    },
    {
      "levelNumber": 4,
      "smallBlind": 100,
      "bigBlind": 200,
      "ante": 25,
      "durationMinutes": 20
    },
    {
      "levelNumber": 5,
      "smallBlind": 0,
      "bigBlind": 0,
      "ante": 0,
      "durationMinutes": 15,
      "isBreak": true,
      "breakName": "Перерыв 15 минут"
    },
    {
      "levelNumber": 6,
      "smallBlind": 150,
      "bigBlind": 300,
      "ante": 50,
      "durationMinutes": 20
    },
    {
      "levelNumber": 7,
      "smallBlind": 200,
      "bigBlind": 400,
      "ante": 50,
      "durationMinutes": 20
    },
    {
      "levelNumber": 8,
      "smallBlind": 300,
      "bigBlind": 600,
      "ante": 100,
      "durationMinutes": 20
    }
  ]
}

# ⚠️ СКОПИРУЙ structure.id из ответа и замени @blindStructureId


### 3. Получить все структуры
GET {{baseUrl}}/blind-structures
Authorization: Bearer {{adminToken}}


### 4. Получить детали структуры
GET {{baseUrl}}/blind-structures/{{blindStructureId}}
Authorization: Bearer {{adminToken}}


### 5. Добавить уровень к структуре
POST {{baseUrl}}/blind-structures/{{blindStructureId}}/levels
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "levelNumber": 9,
  "smallBlind": 400,
  "bigBlind": 800,
  "ante": 100,
  "durationMinutes": 20
}


### ============================================
### ЭТАП 7.2: СОЗДАНИЕ ТУРНИРА С БЛАЙНДАМИ
### ============================================

### 6. Создать турнир с привязкой к структуре блайндов
POST {{baseUrl}}/tournaments
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "name": "Friday Night Poker with Blinds",
  "startTime": "2026-02-07T19:00:00Z",
  "buyInAmount": 1000,
  "startingStack": 10000,
  "blindStructureId": "{{blindStructureId}}"
}

# ⚠️ СКОПИРУЙ id турнира и замени @tournamentId


### 7. Зарегистрировать игроков (используй токены из предыдущих тестов)
# Войди как игрок 2 и зарегистрируйся
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "phone": "+79993333333",
  "password": "player123"
}

# СКОПИРУЙ token игрока 2

### 8. Регистрация игрока 2 на турнир
POST {{baseUrl}}/tournaments/{{tournamentId}}/register
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI4NGU5NzQ2Yy01MjhjLTQzYjAtYTU1ZC0wNmU0MmRkZDYxNTciLCJyb2xlIjoiUExBWUVSIiwiaWF0IjoxNzcwMjQzMzIwLCJleHAiOjE3NzA4NDgxMjB9.dDM5heBU8qwKidiBIMxEMWAB9LeCYtR2ZOqYeMQb3xI

{
  "paymentMethod": "DEPOSIT"
}

# Повтори для игроков 3 и 4


### ============================================
### ЭТАП 7.3: LIVE ОПЕРАЦИИ
### ============================================

### 9. Запустить турнир (изменить статус)
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/status
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "status": "LATE_REG"
}


### 10. Получить текущий уровень турнира
GET {{baseUrl}}/tournaments/{{tournamentId}}/level/current
Authorization: Bearer {{adminToken}}


### 11. Перейти на следующий уровень
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/level/next
Authorization: Bearer {{adminToken}}


### 12. Проверить новый уровень
GET {{baseUrl}}/tournaments/{{tournamentId}}/level/current
Authorization: Bearer {{adminToken}}

### 12. Проверить новый уровень
POST {{baseUrl}}/tournaments/{{tournamentId}}/seating/auto
Authorization: Bearer {{adminToken}}

### 13. Получить список игроков с playerId
GET {{baseUrl}}/tournaments/{{tournamentId}}/tables
Authorization: Bearer {{adminToken}}

# ⚠️ СКОПИРУЙ playerId из ответа и замени @playerId


### 14. Ребай для игрока
POST {{baseUrl}}/tournaments/{{tournamentId}}/player/{{playerId}}/rebuy
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "amount": 1000
}


### 15. Аддон для игрока
POST {{baseUrl}}/tournaments/{{tournamentId}}/player/{{playerId}}/addon
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "amount": 500
}


### 16. Получить историю операций игрока
GET {{baseUrl}}/tournaments/{{tournamentId}}/player/{{playerId}}/operations
Authorization: Bearer {{adminToken}}


### 17. Выбить игрока (4 место, приз 2000)
POST {{baseUrl}}/tournaments/{{tournamentId}}/player/{{playerId}}/eliminate
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "finishPosition": 4,
  "prizeAmount": 2000
}


### 18. Проверить что игрок исключен со стола
GET {{baseUrl}}/tournaments/{{tournamentId}}/tables
Authorization: Bearer {{adminToken}}


### 19. Перейти на уровень 3
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/level/next
Authorization: Bearer {{adminToken}}


### 20. Перейти на уровень 4
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/level/next
Authorization: Bearer {{adminToken}}


### 21. Перейти на уровень 5 (должен быть перерыв)
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/level/next
Authorization: Bearer {{adminToken}}


### 22. Проверить текущий уровень (должен быть перерыв)
GET {{baseUrl}}/tournaments/{{tournamentId}}/level/current
Authorization: Bearer {{adminToken}}


### 23. Завершить турнир
PATCH {{baseUrl}}/tournaments/{{tournamentId}}/status
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "status": "FINISHED"
}
